<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermal Cooling Loop Digital Twin</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Thermal Cooling Loop Digital Twin</h1>
            <p>Advanced real-time monitoring and ML-based anomaly detection for thermal management systems</p>
            <div class="header-controls">
                <button id="connectBtn" class="btn btn-primary">Connect to Backend</button>
                <div class="connection-status" id="connectionStatus">Disconnected</div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button active" onclick="showTab('simulation')">Simulation</button>
            <button class="tab-button" onclick="showTab('monitoring')">Real-time Monitoring</button>
            <button class="tab-button" onclick="showTab('ml-detection')">ML Detection</button>
            <button class="tab-button" onclick="showTab('testing')">Fault Testing</button>
            <button class="tab-button" onclick="showTab('analysis')">Analysis</button>
        </nav>

        <main>
            <!-- Simulation Tab -->
            <div id="simulation" class="tab-content active">
                <h2>System Simulation</h2>
                <div class="simulation-controls">
                    <div class="control-section">
                        <h3>System Parameters</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="thermal-capacitance">Thermal Capacitance (J/K):</label>
                                <input type="range" id="thermal-capacitance" min="1000" max="10000" value="1000" step="100">
                                <span id="thermal-capacitance-value">1000 J/K</span>
                            </div>
                            <div class="control-group">
                                <label for="mass-flow">Mass Flow Rate (kg/s):</label>
                                <input type="range" id="mass-flow" min="0.01" max="1.0" value="0.1" step="0.01">
                                <span id="mass-flow-value">0.1 kg/s</span>
                            </div>
                            <div class="control-group">
                                <label for="heat-capacity">Heat Capacity (J/K):</label>
                                <input type="range" id="heat-capacity" min="1000" max="10000" value="4180" step="100">
                                <span id="heat-capacity-value">4180 J/K</span>
                            </div>
                            <div class="control-group">
                                <label for="heat-exchanger">Heat Exchanger UA (W/K):</label>
                                <input type="range" id="heat-exchanger" min="10" max="500" value="50" step="5">
                                <span id="heat-exchanger-value">50 W/K</span>
                            </div>
                            <div class="control-group">
                                <label for="heat-input">Heat Input (W):</label>
                                <input type="range" id="heat-input" min="500" max="3000" value="1000" step="50">
                                <span id="heat-input-value">1000 W</span>
                            </div>
                            <div class="control-group">
                                <label for="heat-output">Heat Output (W):</label>
                                <input type="range" id="heat-output" min="0" max="2000" value="1000" step="50">
                                <span id="heat-output-value">1000 W</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h3>Initial Conditions</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="initialTempHot">Initial T_hot (K):</label>
                                <input type="range" id="initialTempHot" min="250" max="400" value="350" step="1">
                                <span id="initialTempHotValue">350 K</span>
                            </div>
                            <div class="control-group">
                                <label for="initialTempCold">Initial T_cold (K):</label>
                                <input type="range" id="initialTempCold" min="200" max="350" value="300" step="1">
                                <span id="initialTempColdValue">300 K</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Simulation Settings</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="simDuration">Duration (s):</label>
                                <input type="range" id="simDuration" min="100" max="1000" value="300" step="10">
                                <span id="simDurationValue">300 s</span>
                            </div>
                            <div class="control-group">
                                <label for="sampleRate">Sample Rate (Hz):</label>
                                <input type="range" id="sampleRate" min="0.1" max="10" value="1" step="0.1">
                                <span id="sampleRateValue">1 Hz</span>
                            </div>
                            <div class="control-group">
                                <label for="heatInputType">Heat Input Type:</label>
                                <select id="heatInputType">
                                    <option value="constant">Constant</option>
                                    <option value="step">Step</option>
                                    <option value="ramp">Ramp</option>
                                    <option value="pulse">Pulse</option>
                                    <option value="sine">Sine Wave</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="start-simulation" class="btn btn-primary">Start Simulation</button>
                    <button id="stop-simulation" class="btn btn-secondary" disabled>Stop Simulation</button>
                    <button id="reset-simulation" class="btn btn-warning">Reset</button>
                    <button id="exportData" class="btn btn-info">Export Data</button>
                </div>
                
                <div class="chart-container">
                    <canvas id="temperature-chart"></canvas>
                </div>
                
                <div class="chart-container">
                    <canvas id="residuals-chart"></canvas>
                </div>
                
                <div class="simulation-results" id="simulationResults" style="display: none;">
                    <h3>Simulation Results</h3>
                    <div class="results-grid">
                        <div class="result-card">
                            <h4>Final Temperatures</h4>
                            <p>Plant T_hot: <span id="finalPlantHot">--</span> K</p>
                            <p>Twin T_hot: <span id="finalTwinHot">--</span> K</p>
                        </div>
                        <div class="result-card">
                            <h4>Temperature Range</h4>
                            <p>Min: <span id="minTemp">--</span> K</p>
                            <p>Max: <span id="maxTemp">--</span> K</p>
                        </div>
                        <div class="result-card">
                            <h4>Residual Statistics</h4>
                            <p>Mean: <span id="meanResidual">--</span> K</p>
                            <p>Std Dev: <span id="stdResidual">--</span> K</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Monitoring Tab -->
            <div id="monitoring" class="tab-content">
                <h2>Real-time Monitoring</h2>
                <div class="monitoring-controls">
                    <div class="control-group">
                        <label for="monitoringRate">Update Rate (Hz):</label>
                        <input type="range" id="monitoringRate" min="0.1" max="5" value="1" step="0.1">
                        <span id="monitoringRateValue">1 Hz</span>
                    </div>
                    <div class="control-group">
                        <label for="detectionMethods">Detection Methods:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" value="residual_threshold" checked> Residual Threshold</label>
                            <label><input type="checkbox" value="rolling_z_score" checked> Rolling Z-Score</label>
                            <label><input type="checkbox" value="isolation_forest" checked> Isolation Forest</label>
                            <label><input type="checkbox" value="one_class_svm"> One-Class SVM</label>
                        </div>
                    </div>
                    <button id="startMonitoring" class="btn btn-primary">Start Monitoring</button>
                    <button id="stopMonitoring" class="btn btn-secondary" disabled>Stop Monitoring</button>
                </div>
                
                <div class="status-grid">
                    <div class="status-card">
                        <h3>Plant Temperature (Hot)</h3>
                        <div class="metric" id="plant-temp-hot">-- K</div>
                        <div class="trend" id="plantTempHotTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Plant Temperature (Cold)</h3>
                        <div class="metric" id="plant-temp-cold">-- K</div>
                        <div class="trend" id="plantTempColdTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Twin Temperature (Hot)</h3>
                        <div class="metric" id="twin-temp-hot">-- K</div>
                        <div class="trend" id="twinTempHotTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Twin Temperature (Cold)</h3>
                        <div class="metric" id="twin-temp-cold">-- K</div>
                        <div class="trend" id="twinTempColdTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Mass Flow</h3>
                        <div class="metric" id="mass-flow">-- kg/s</div>
                        <div class="trend" id="massFlowTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Residual (Hot)</h3>
                        <div class="metric" id="residual-temp-hot">-- K</div>
                        <div class="trend" id="residualHotTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Residual (Cold)</h3>
                        <div class="metric" id="residual-temp-cold">-- K</div>
                        <div class="trend" id="residualColdTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Residual (Mass Flow)</h3>
                        <div class="metric" id="residual-mass-flow">-- kg/s</div>
                        <div class="trend" id="residualMassFlowTrend">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Anomaly Status</h3>
                        <div class="metric" id="anomaly-status">Normal</div>
                        <div class="confidence" id="anomaly-confidence">--</div>
                    </div>
                    <div class="status-card">
                        <h3>Anomaly Severity</h3>
                        <div class="metric" id="anomaly-severity">Normal</div>
                        <div class="confidence" id="anomaly-method">--</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="monitoringChart"></canvas>
                </div>
                
                <div class="anomaly-log" id="anomalyLog">
                    <h3>Anomaly Log</h3>
                    <div class="log-entries" id="anomaly-list">
                        <p class="log-entry">No anomalies detected</p>
                    </div>
                </div>
            </div>

            <!-- ML Detection Tab -->
            <div id="ml-detection" class="tab-content">
                <h2>Advanced ML Anomaly Detection</h2>
                
                <div class="ml-controls">
                    <div class="control-section">
                        <h3>ML Configuration</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="mlEnabled">Enable ML Detection:</label>
                                <input type="checkbox" id="mlEnabled" checked>
                            </div>
                            <div class="control-group">
                                <label for="featureEngineering">Feature Engineering:</label>
                                <input type="checkbox" id="featureEngineering" checked>
                            </div>
                            <div class="control-group">
                                <label for="ensembleVoting">Ensemble Voting:</label>
                                <input type="checkbox" id="ensembleVoting" checked>
                            </div>
                            <div class="control-group">
                                <label for="adaptiveThresholds">Adaptive Thresholds:</label>
                                <input type="checkbox" id="adaptiveThresholds" checked>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h3>Model Training</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="trainingSamples">Training Samples:</label>
                                <input type="range" id="trainingSamples" min="50" max="500" value="100" step="10">
                                <span id="trainingSamplesValue">100</span>
                            </div>
                            <div class="control-group">
                                <label for="testSize">Test Size:</label>
                                <input type="range" id="testSize" min="0.1" max="0.5" value="0.2" step="0.05">
                                <span id="testSizeValue">0.2</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="ml-actions">
                    <button id="createMLDetector" class="btn btn-primary">Create ML Detector</button>
                    <button id="generateTrainingData" class="btn btn-info">Generate Training Data</button>
                    <button id="trainModels" class="btn btn-success">Train Models</button>
                    <button id="resetML" class="btn btn-secondary">Reset ML</button>
                </div>
                
                <div class="ml-status" id="mlStatus">
                    <h3>ML Detector Status</h3>
                    <div class="status-grid">
                        <div class="status-card">
                            <h4>Enhanced Detector</h4>
                            <div class="metric" id="enhancedDetectorStatus">Not Created</div>
                        </div>
                        <div class="status-card">
                            <h4>ML Detector</h4>
                            <div class="metric" id="mlDetectorStatus">Not Created</div>
                        </div>
                        <div class="status-card">
                            <h4>Training Data</h4>
                            <div class="metric" id="trainingDataStatus">0 samples</div>
                        </div>
                        <div class="status-card">
                            <h4>Model Performance</h4>
                            <div class="metric" id="modelPerformance">--</div>
                        </div>
                    </div>
                </div>
                
                <div class="ml-testing" id="mlTesting" style="display: none;">
                    <h3>ML Detection Testing</h3>
                    <div class="test-scenarios">
                        <div class="control-group">
                            <label for="testScenario">Test Scenario:</label>
                            <select id="testScenario">
                                <option value="normal">Normal Operation</option>
                                <option value="temp_anomaly">Temperature Anomaly</option>
                                <option value="flow_anomaly">Flow Rate Anomaly</option>
                                <option value="multiple_anomalies">Multiple Anomalies</option>
                            </select>
                        </div>
                        <button id="testDetection" class="btn btn-warning">Test Detection</button>
                    </div>
                    
                    <div class="test-results" id="testResults" style="display: none;">
                        <h4>Test Results</h4>
                        <div class="results-grid">
                            <div class="result-card">
                                <h5>Detection Result</h5>
                                <p>Anomaly: <span id="testAnomaly">--</span></p>
                                <p>Confidence: <span id="testConfidence">--</span></p>
                            </div>
                            <div class="result-card">
                                <h5>Method Used</h5>
                                <p>Method: <span id="testMethod">--</span></p>
                                <p>Severity: <span id="testSeverity">--</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="mlChart"></canvas>
                </div>
            </div>

            <!-- Fault Testing Tab -->
            <div id="testing" class="tab-content">
                <h2>Fault Testing & Injection</h2>
                
                <div class="fault-controls">
                    <div class="control-section">
                        <h3>Fault Configuration</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="faultType">Fault Type:</label>
                                <select id="faultType">
                                    <option value="none">None</option>
                                    <option value="pump_degradation">Pump Degradation</option>
                                    <option value="heat_exchanger_fouling">Heat Exchanger Fouling</option>
                                    <option value="sensor_bias">Sensor Bias</option>
                                    <option value="sensor_noise">Sensor Noise Increase</option>
                                    <option value="mass_flow_reduction">Mass Flow Reduction</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="faultStartTime">Fault Start Time (s):</label>
                                <input type="range" id="faultStartTime" min="0" max="100" value="50" step="1">
                                <span id="faultStartTimeValue">50 s</span>
                            </div>
                            <div class="control-group">
                                <label for="faultSeverity">Fault Severity:</label>
                                <input type="range" id="faultSeverity" min="0.1" max="1.0" value="0.5" step="0.1">
                                <span id="faultSeverityValue">0.5</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-section">
                        <h3>Sensor Configuration</h3>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="sensorNoise">Sensor Noise Level:</label>
                                <input type="range" id="sensorNoise" min="0" max="2" value="0.5" step="0.1">
                                <span id="sensorNoiseValue">0.5 K</span>
                            </div>
                            <div class="control-group">
                                <label for="sensorBias">Sensor Bias:</label>
                                <input type="range" id="sensorBias" min="-10" max="10" value="0" step="0.5">
                                <span id="sensorBiasValue">0 K</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="fault-actions">
                    <button id="injectFault" class="btn btn-warning">Inject Fault</button>
                    <button id="clearFaults" class="btn btn-secondary">Clear Faults</button>
                    <button id="runFaultTest" class="btn btn-danger">Run Fault Test</button>
                </div>
                
                <div class="fault-status" id="faultStatus">
                    <h3>Active Faults</h3>
                    <div class="fault-list" id="faultList">
                        <p>No active faults</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="testingChart"></canvas>
                </div>
                
                <div class="fault-results" id="faultResults" style="display: none;">
                    <h3>Fault Test Results</h3>
                    <div class="results-grid">
                        <div class="result-card">
                            <h4>Detection Performance</h4>
                            <p>Detection Time: <span id="detectionTime">--</span> s</p>
                            <p>False Positives: <span id="falsePositives">--</span></p>
                        </div>
                        <div class="result-card">
                            <h4>System Impact</h4>
                            <p>Max Temperature: <span id="maxTempFault">--</span> K</p>
                            <p>Max Residual: <span id="maxResidualFault">--</span> K</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysis" class="tab-content">
                <h2>System Analysis & Performance</h2>
                
                <div class="analysis-controls">
                    <div class="control-group">
                        <label for="analysisTimeWindow">Time Window (s):</label>
                        <input type="range" id="analysisTimeWindow" min="60" max="3600" value="300" step="60">
                        <span id="analysisTimeWindowValue">300 s</span>
                    </div>
                    <div class="control-group">
                        <label for="analysisType">Analysis Type:</label>
                        <select id="analysisType">
                            <option value="performance">Performance Analysis</option>
                            <option value="anomaly">Anomaly Analysis</option>
                            <option value="residual">Residual Analysis</option>
                            <option value="comparison">Method Comparison</option>
                        </select>
                    </div>
                    <button id="runAnalysis" class="btn btn-primary">Run Analysis</button>
                    <button id="exportAnalysis" class="btn btn-info">Export Analysis</button>
                </div>
                
                <div class="analysis-results" id="analysisResults">
                    <div class="analysis-section">
                        <h3>Performance Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <h4>Detection Accuracy</h4>
                                <div class="metric-value" id="detectionAccuracy">--</div>
                            </div>
                            <div class="metric-card">
                                <h4>False Positive Rate</h4>
                                <div class="metric-value" id="falsePositiveRate">--</div>
                            </div>
                            <div class="metric-card">
                                <h4>Response Time</h4>
                                <div class="metric-value" id="responseTime">--</div>
                            </div>
                            <div class="metric-card">
                                <h4>System Stability</h4>
                                <div class="metric-value" id="systemStability">--</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <h3>Statistical Analysis</h3>
                        <div class="chart-container">
                            <canvas id="analysisChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analysis-section">
                        <h3>Method Comparison</h3>
                        <div class="comparison-table" id="comparisonTable">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Method</th>
                                        <th>Accuracy</th>
                                        <th>Precision</th>
                                        <th>Recall</th>
                                        <th>F1-Score</th>
                                    </tr>
                                </thead>
                                <tbody id="comparisonTableBody">
                                    <tr><td colspan="5">No data available</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Thermal Cooling Loop Digital Twin</h4>
                    <p>Advanced real-time monitoring and ML-based anomaly detection</p>
                </div>
                <div class="footer-section">
                    <h4>Features</h4>
                    <ul>
                        <li>Real-time simulation</li>
                        <li>ML anomaly detection</li>
                        <li>Fault injection testing</li>
                        <li>Performance analysis</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Technology</h4>
                    <ul>
                        <li>Python & SciPy</li>
                        <li>Machine Learning</li>
                        <li>Real-time Processing</li>
                        <li>Web Technologies</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Thermal Cooling Loop Digital Twin. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script src="js/main.js"></script>
    <script src="js/simulation.js"></script>
    <script src="js/monitoring.js"></script>
    <script src="js/ml-detection.js"></script>
    <script src="js/testing.js"></script>
    <script src="js/analysis.js"></script>
    <script src="js/demo-mode.js"></script>
</body>
</html>